{% extends "partials/dashboard-base.html" %}
{% load static %}
{% load humanize %}
{% block content %}

{% if is_frozen %}
<!-- Account Frozen Full-Page Overlay (Theme Match) -->
<div id="freeze-overlay" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(4px);
    z-index: 999999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
">
    <!-- Main Card -->
    <div style="
        background: #ffffff;
        border-radius: 20px;
        padding: 50px 10px;
        text-align: center;
        max-width: 500px;
        width: 100%;
        box-shadow: 0 10px 40px rgba(12, 38, 110, 0.1);
        border: 1px solid #eeecf7;
    ">
        <!-- Icon -->
        <div style="margin-bottom: 30px;">
            <div style="
                width: 80px;
                height: 80px;
                background: rgba(220, 53, 69, 0.1);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto;
            ">
                <i class="fas fa-ban" style="font-size: 32px; color: #dc3545;"></i>
            </div>
        </div>

        <!-- Headline -->
        <h3 class="title" style="margin-bottom: 15px; color: var(--head-color);">Account Suspended</h3>

        <!-- Reason Badge -->
        <div style="margin-bottom: 25px;">
            <span style="
                background: #f8d7da;
                color: #721c24;
                padding: 5px 15px;
                border-radius: 30px;
                font-size: 14px;
                font-weight: 500;
                display: inline-block;
            ">
                {{ freeze_reason|default:"Security Alert" }}
            </span>
        </div>

        <!-- Description -->
        <p style="color: var(--para-color); margin-bottom: 35px; line-height: 1.6;">
            {% if freeze_notes %}
                {{ freeze_notes }}
            {% else %}
                Your account access has been temporarily restricted. Please contact our support team for assistance.
            {% endif %}
        </p>

        <!-- Contact Info (Not a button) -->
        <div style="margin-bottom: 30px;">
            <p style="color: var(--para-color); font-size: 16px; margin-bottom: 5px; font-weight: 500;">
                Please contact your Account Officer
            </p>
            <p style="color: var(--primary-color); font-size: 15px; font-weight: 600; margin: 0;">
                <i class="fas fa-envelope" style="margin-right: 8px;"></i> support@paylio.com
            </p>
        </div>

        <!-- Actions -->
        <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
            <a href="{% url 'userauths:sign-out' %}" class="cmn-btn">
                <i class="fas fa-sign-out-alt" style="margin-right: 10px;"></i> Sign Out
            </a>
        </div>
        
        <!-- Footer Info -->
        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eeecf7;">
            <p style="font-size: 13px; color: #868ea5; margin: 0;">
                Reference: #FRZ-{{ user.id }}-{{ account.id|slice:":4" }}
            </p>
        </div>
    </div>
</div>
{% endif %}

<!-- Dashboard Section start -->
<section class="dashboard-section body-collapse">
    <div class="overlay pt-120">
        <div class="container-fruid">
            {% if form.errors %}
            <div class="alert alert-danger">
                <strong>{{form.errors}}</strong>
            </div>
            {% endif %}
            <div class="row">
                <div class="col-xl-8 col-lg-7">
                    <div class="section-content">
                        <div class="acc-details">
                            <div class="top-area">
                                <div class="left-side">
                                    <h5>Hi, {{kyc.full_name}}</h5>
                                    <h2><span id="display-balance"
                                            data-balance="{{account.account_balance}}"></span>${{account.account_balance|floatformat:2|intcomma}}</span>
                                    </h2>
                                    <h5 class="receive">Account Balance </h5>
                                </div>

                            </div>
                            <div class="bottom-area">
                                <div class="left-side">
                                    <a href="{% url 'core:transfer-selection' %}" class="cmn-btn">Transfer Money</a>
                                    <a href="{% url 'core:all-cards' %}" class="cmn-btn">All Cards</a>
                                </div>
                                
                            </div>
                        </div>
                        <div class="transactions-area mt-40">
                            <div class="section-text">
                                <h5>Transactions</h5>
                            </div>
                            <div class="top-area d-flex align-items-center justify-content-between">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="latest-tab" data-bs-toggle="tab"
                                            data-bs-target="#latest" type="button" role="tab" aria-controls="latest"
                                            aria-selected="true">Sent</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="upcoming-tab" data-bs-toggle="tab"
                                            data-bs-target="#upcoming" type="button" role="tab" aria-controls="upcoming"
                                            aria-selected="false">Received</button>
                                    </li>
                                </ul>
                                <div class="view-all d-flex align-items-center">
                                    <a href="{% url 'core:transaction-list' %}">View All</a>
                                    <img src="{% static 'assets1/images/icon/right-arrow.png' %}" alt="icon">
                                </div>
                            </div>
                            <div class="tab-content mt-40">
                                <div class="tab-pane fade show active" id="latest" role="tabpanel"
                                    aria-labelledby="latest-tab">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th scope="col">Name/ Business</th>
                                                    <th scope="col">Date</th>
                                                    <th scope="col">Status</th>
                                                    <th scope="col">Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                {% for s in sender_transaction %}
                                                <tr data-bs-toggle="modal" data-bs-target="#transactionsMod">
                                                    <th scope="row">
                                                        <p>{{s.reciever.kyc.full_name|title}}</p>
                                                        <p class="mdr">{{s.transaction_type|title}}</p>
                                                    </th>
                                                    <td>
                                                        <p><small>{{s.date|date:"h:i"}}</small></p>
                                                        <p class="mdr">{{s.date|date:"d M, Y"}}</p>
                                                    </td>
                                                    <td>
                                                        {% if s.status == 'completed' %}
                                                        <p class="text-success">{{s.status|title}}</p>
                                                        {% endif %}
                                                        {% if s.status == 'pending' %}
                                                        <p class="inprogress">{{s.status|title}}</p>
                                                        {% endif %}
                                                        {% if s.status == 'failed' %}
                                                        <p class="danger">Reversed</p>
                                                        {% endif %}
                                                        {% if s.status == 'processing' %}
                                                        <p class="inprogress">{{s.status|title}}</p>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <p>-${{s.amount|intcomma}}</p>
                                                    </td>
                                                    <td>
                                                        <a href="{% url 'core:transaction-detail' s.transaction_id %}"
                                                            class=""><i class="fas fa-eye"></i></a>

                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th scope="col">Name/ Business</th>
                                                    <th scope="col">Date</th>
                                                    <th scope="col">Status</th>
                                                    <th scope="col">Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for s in reciever_transaction %}
                                                <tr data-bs-toggle="modal" data-bs-target="#transactionsMod">
                                                    <th scope="row">
                                                        <p>{{s.sender.kyc.full_name|title}}</p>
                                                        <p class="mdr">{{s.transaction_type|title}}</p>
                                                    </th>
                                                    <td>
                                                        <p><small>{{s.date|date:"h:i"}}</small></p>
                                                        <p class="mdr">{{s.date|date:"d M, Y"}}</p>
                                                    </td>
                                                    <td>
                                                        {% if s.status == 'completed' %}
                                                        <p class="text-success">{{s.status|title}}</p>
                                                        {% endif %}
                                                        {% if s.status == 'pending' %}
                                                        <p class="inprogress">{{s.status|title}}</p>
                                                        {% endif %}
                                                        {% if s.status == 'failed' %}
                                                        <p class="danger">Reversed</p>
                                                        {% endif %}
                                                        {% if s.status == 'processing' %}
                                                        <p class="inprogress">{{s.status|title}}</p>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <p>+${{s.amount|intcomma}}</p>
                                                    </td>
                                                    <td>
                                                        <a href="{% url 'core:transaction-detail' s.transaction_id %}"
                                                            class=""><i class="fas fa-eye"></i></a>
                                                    </td>
                                                </tr>
                                                {% endfor %}

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-5">
                    <div class="side-items">
                        <div class="single-item">
                            <div class="section-text d-flex align-items-center justify-content-between">
                                <h6>Saved Payment Cards</h6>
                                <div class="view-all d-flex align-items-center">
                                    <a href="{% url 'core:all-cards' %}">View All</a>
                                    <img src="{% static 'assets1/images/icon/right-arrow.png' %}" alt="icon">
                                </div>
                            </div>
                            <!-- Horizontal Card Slider -->
                            <div class="card-slider-container">
                                <div class="card-slider">
                                    {% for c in credit_card %}
                                    <a href="{% url 'core:deposit-with-saved-card' c.card_id %}" class="slider-card-item">
                                        <div class="slider-card-visual" data-brand="{{ c.card_type }}">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <div class="slider-chip"></div>
                                                <div class="slider-brand-icon">
                                                    {% if c.card_type == 'visa' %}
                                                    <i class="fa-brands fa-cc-visa" style="color: #005eff;"></i>
                                                    {% elif c.card_type == 'master' %}
                                                    <i class="fa-brands fa-cc-mastercard" style="color: #0a0a0a;"></i>
                                                    {% elif c.card_type == 'amex' %}
                                                    <i class="fa-brands fa-cc-amex" style="color: #74C0FC;"></i>
                                                    {% elif c.card_type == 'discover' %}
                                                    <i class="fa-brands fa-cc-discover" style="color: #f7ab08;"></i>
                                                    {% else %}
                                                    <i class="fa-solid fa-credit-card" style="color: #04307c;"></i>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="slider-card-number mb-3">
                                                {{ c.masked_number }}
                                            </div>
                                            <div class="d-flex justify-content-between align-items-end">
                                                <div class="slider-card-holder text-truncate">{{ c.name }}</div>
                                                <div class="slider-card-expiry">{{ c.expiry_display }}</div>
                                            </div>
                                        </div>
                                    </a>
                                    {% empty %}
                                    <div class="w-100 text-center py-4 text-muted">No saved cards</div>
                                    {% endfor %}
                                    
                                    <!-- Add Card Slide -->
                                    <div class="slider-card-item add-card-slide" data-bs-toggle="modal" data-bs-target="#addcardMod">
                                        <div class="slider-card-visual add-new-visual d-flex flex-column align-items-center justify-content-center h-100">
                                            <div class="icon-circle mb-2">
                                                <i class="fas fa-plus"></i>
                                            </div>
                                            <span class="fw-bold">Add New Card</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <style>
                                /* Dashboard Card Slider Styles */
                                .card-slider-container { width: 100%; overflow: hidden; padding: 10px 0; }
                                .card-slider { display: flex; overflow-x: auto; gap: 15px; padding: 5px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
                                .card-slider::-webkit-scrollbar { display: none; }
                                .slider-card-item { flex: 0 0 260px; scroll-snap-align: center; text-decoration: none; transition: transform 0.3s ease; cursor: pointer; }
                                .slider-card-item:hover { transform: translateY(-5px); }
                                
                                .slider-card-visual {
                                    background: linear-gradient(135deg, #4743c9 0%, #0c266c 100%);
                                    border-radius: 15px;
                                    padding: 20px;
                                    color: white;
                                    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
                                    position: relative;
                                    height: 160px;
                                    display: flex;
                                    flex-direction: column;
                                    justify-content: space-between;
                                    overflow: hidden;
                                }
                                
                                /* Brands */
                                .slider-card-visual[data-brand="visa"] { background: linear-gradient(135deg, #1A1F71 0%, #29318C 100%); }
                                .slider-card-visual[data-brand="master"] { background: linear-gradient(135deg, #EB001B 0%, #F79E1B 100%); }
                                .slider-card-visual[data-brand="amex"] { background: linear-gradient(135deg, #006FCF 0%, #004687 100%); }
                                .slider-card-visual[data-brand="discover"] { background: linear-gradient(135deg, #FF6000 0%, #FF9D00 100%); }
                                .slider-card-visual[data-brand="verve"] { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }

                                .slider-card-visual::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at 85% 15%, rgba(255,255,255,0.15) 0%, transparent 50%); pointer-events: none; }
                                .slider-chip { width: 35px; height: 25px; background: linear-gradient(135deg, #ffd700 0%, #fdb931 100%); border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
                                .slider-brand-icon { font-size: 24px; color: rgba(255,255,255,0.9); }
                                .slider-card-number { font-family: 'Courier New', monospace; font-size: 15px; letter-spacing: 2px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); margin-top: auto; }
                                .slider-card-holder { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; max-width: 150px; }
                                .slider-card-expiry { font-size: 12px; font-weight: 600; }
                                
                                /* Add New Card Slide */
                                .add-new-visual { background: #fff; border: 2px dashed #eef0f8; color: #4743c9; box-shadow: none; justify-content: center; align-items: center; }
                                .add-new-visual:hover { background: #f9faff; border-color: #4743c9; }
                                .add-new-visual .icon-circle { width: 50px; height: 50px; background: #eef0f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: all 0.3s; }
                                .add-new-visual:hover .icon-circle { background: #4743c9; color: #fff; }
                            </style>
                        </div>
                        <div class="single-item">
                            <div class="section-text d-flex align-items-center justify-content-between">
                                <h6>Payment Analytics</h6>
                                <!-- <div class="select-box">
                                    <select>
                                        <option>Monthly</option>
                                        <option value="1">Jan</option>
                                        <option value="2">Feb</option>
                                        <option value="3">Mar</option>
                                    </select>
                                </div> -->
                            </div>
                            <div id="payment-chart"></div>
                        </div>
                        <div class="single-item">
                            <div class="section-text d-flex align-items-center justify-content-between">
                                <h6>Notification ({{notifications.count}})</h6>
                                <div class="view-all d-flex align-items-center">
                                    <a href="javascript:void(0)">View All</a>
                                    <img src="{% static 'assets1/images/icon/right-arrow.png' %}" alt="icon">
                                </div>
                            </div>
                            <ul class="recipients-item">
                                {% for n in notifications %}
                                <li>

                                    <a href="javascript:void(0)" class="d-flex">
                                        <div class="text-area">

                                            {% if n.notification_type == "Credit Alert" %}
                                            <p class="mdr">You received a payment of <b>${{n.amount}}</b></p>
                                            {% endif %}
                                            {% if n.notification_type == "Debit Alert" %}
                                            <p class="mdr">You sent a payment of <b>${{n.amount}}</b></p>
                                            {% endif %}
                                            {% if n.notification_type == "Sent Payment Request" %}
                                            <p class="mdr">You sent a <b>payment request</b> of <b>${{n.amount}}</b></p>
                                            {% endif %}
                                            {% if n.notification_type == "Recieved Payment Request" %}
                                            <p class="mdr">You received a <b>payment request</b> of <b>${{n.amount}}</b>
                                            </p>
                                            {% endif %}
                                            {% if n.notification_type == "Funded Credit Card" %}
                                            <p class="mdr">You funded your credit card with <b>${{n.amount}}</b></p>
                                            {% endif %}
                                            {% if n.notification_type == "Withdrew Credit Card Funds" %}
                                            <p class="mdr">You withdrew <b>${{n.amount}}</b> from your credit card</p>
                                            {% endif %}
                                            {% if n.notification_type == "Deleted Credit Card" %}
                                            <p class="mdr">You deleted your credit card</p>
                                            {% endif %}
                                            {% if n.notification_type == "Added Credit Card" %}
                                            <p class="mdr">You added a new credit card</p>
                                            {% endif %}

                                            <p class="mdr time-area">{{n.date}}</p>
                                        </div>
                                    </a>
                                    <i class="fa-solid fa-caret-right"></i>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Dashboard Section end -->

<!-- Card Popup start -->
<div class="card-popup">
    <div class="container-fruid">
        <div class="row">
            <div class="col-lg-6">
                <div class="modal fade" id="cardMod" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header justify-content-center">
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i
                                        class="fa-solid fa-xmark"></i></button>
                            </div>
                            <div class="main-content">
                                <div class="top-area mb-40 mt-40 text-center">
                                    <div class="card-area mb-30">
                                        <img src="assets/images/visa-card-2.png" alt="image">
                                    </div>
                                    <div class="text-area">
                                        <h5>Paylio payment Card </h5>
                                        <p>Linked: 01 Jun 2021</p>
                                    </div>
                                </div>
                                <div class="tab-area d-flex align-items-center justify-content-between">
                                    <ul class="nav nav-tabs mb-30" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="btn-link" id="cancel-tab" data-bs-toggle="tab"
                                                data-bs-target="#cancel" type="button" role="tab" aria-controls="cancel"
                                                aria-selected="false">
                                                <img src="assets/images/icon/limit.png" alt="icon">
                                                Set transfer limit
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="d-none" id="limit-tab" data-bs-toggle="tab"
                                                data-bs-target="#limit" type="button" role="tab" aria-controls="limit"
                                                aria-selected="true"></button>
                                        </li>
                                        <li>
                                            <button>
                                                <img src="assets/images/icon/remove.png" alt="icon">
                                                Remove from Linked
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-content mt-30">
                                    <div class="tab-pane fade show active" id="limit" role="tabpanel"
                                        aria-labelledby="limit-tab">
                                        <div class="bottom-area">
                                            <p class="history">Transaction History : <span>20</span></p>
                                            <ul>
                                                <li>
                                                    <p class="left">
                                                        <span>03:00 PM</span>
                                                        <span>17 Oct, 2020</span>
                                                    </p>
                                                    <p class="right">
                                                        <span>$160.48</span>
                                                        <span>Withdraw</span>
                                                    </p>
                                                </li>
                                                <li>
                                                    <p class="left">
                                                        <span>01:09 PM</span>
                                                        <span>15 Oct, 2021</span>
                                                    </p>
                                                    <p class="right">
                                                        <span>$106.58</span>
                                                        <span>Withdraw</span>
                                                    </p>
                                                </li>
                                                <li>
                                                    <p class="left">
                                                        <span>04:00 PM</span>
                                                        <span>12 Oct, 2020</span>
                                                    </p>
                                                    <p class="right">
                                                        <span>$176.58</span>
                                                        <span>Withdraw</span>
                                                    </p>
                                                </li>
                                                <li>
                                                    <p class="left">
                                                        <span>06:00 PM</span>
                                                        <span>25 Oct, 2020</span>
                                                    </p>
                                                    <p class="right">
                                                        <span>$167.85</span>
                                                        <span>Withdraw</span>
                                                    </p>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="cancel" role="tabpanel" aria-labelledby="cancel-tab">
                                        <div class="main-area">
                                            <div class="transfer-area">
                                                <p>Set a transfer limit for paylio payment Card</p>
                                                <p class="mdr">Transfer Limit</p>
                                            </div>
                                            <form action="#">
                                                <div class="input-area">
                                                    <input class="xxlr" placeholder="400.00" type="number">
                                                    <select>
                                                        <option value="1">USD</option>
                                                        <option value="2">USD</option>
                                                        <option value="3">USD</option>
                                                    </select>
                                                </div>
                                                <div
                                                    class="bottom-area d-flex align-items-center justify-content-between">
                                                    <a href="javascript:void(0)" class="cmn-btn cancel">Cancel and
                                                        Back</a>
                                                    <a href="javascript:void(0)" class="cmn-btn">Confirm Transfer
                                                        Limit</a>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Card Popup start -->

<!-- Add Card Popup start -->
<div class="add-card">
    <div class="container-fruid">
        <div class="row">
            <div class="col-lg-6">
                <div class="modal fade" id="addcardMod" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header justify-content-between">
                                <h6>Add New Card</h6>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i
                                        class="fa-solid fa-xmark"></i></button>
                            </div>
                            <div class="modal-body p-4">
                                <!-- Styles for Modal Content -->
                                <style>
                                    /* --- Visual Card Preview --- */
                                    .credit-card-visual-modal {
                                        background: linear-gradient(135deg, #4743c9 0%, #0c266c 100%);
                                        border-radius: 20px;
                                        padding: 30px; /* Slightly smaller padding for modal */
                                        color: #fff;
                                        margin-bottom: 30px;
                                        box-shadow: 0 15px 40px rgba(71, 67, 201, 0.25);
                                        position: relative;
                                        min-height: 220px;
                                        display: flex;
                                        flex-direction: column;
                                        justify-content: space-between;
                                        overflow: hidden;
                                        transition: transform 0.3s ease, box-shadow 0.3s ease;
                                    }

                                    .credit-card-visual-modal::before {
                                        content: '';
                                        position: absolute;
                                        width: 100%;
                                        height: 100%;
                                        top: 0; 
                                        left: 0;
                                        background: radial-gradient(circle at 80% 20%, rgba(255,255,255,0.15) 0%, transparent 50%);
                                        pointer-events: none;
                                    }

                                    .marketing-chip-modal {
                                        width: 45px;
                                        height: 35px;
                                        background: linear-gradient(135deg, #ffd700 0%, #fdb931 100%);
                                        border-radius: 6px;
                                        box-shadow: 0 1px 2px rgba(0,0,0,0.2);
                                    }

                                    .card-brand-logo-modal {
                                        font-size: 35px;
                                        opacity: 0.9;
                                        line-height: 1;
                                    }

                                    .card-number-large-modal {
                                        font-family: 'Courier New', monospace;
                                        font-size: 24px;
                                        letter-spacing: 3px;
                                        font-weight: 700;
                                        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                                        margin-top: 15px;
                                        white-space: nowrap;
                                        overflow: hidden;
                                        text-overflow: ellipsis;
                                    }
                                    
                                    .card-meta-labels-modal { font-size: 10px; text-transform: uppercase; opacity: 0.7; font-weight: 600; margin-bottom: 2px; }
                                    .card-meta-values-modal { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

                                    .form-group-custom-modal { margin-bottom: 20px; position: relative; }
                                    .form-label-custom-modal { display: block; margin-bottom: 6px; font-weight: 600; color: #2c3e50; font-size: 13px; text-transform: uppercase; }
                                    .custom-input-modal { width: 100%; height: 50px; padding: 0 15px; border: 2px solid #eef0f8; border-radius: 10px; font-size: 15px; font-weight: 500; color: #2c3e50; background: #f9faff; transition: all 0.2s ease; }
                                    .custom-input-modal:focus { border-color: #4743c9; background: #fff; outline: none; }
                                    
                                    /* Nice Select Override for Modal */
                                    #addcardMod .nice-select { width: 100% !important; height: 50px !important; line-height: 48px !important; border: 2px solid #eef0f8 !important; border-radius: 10px !important; background-color: #f9faff !important; padding-left: 15px !important; float: none !important; }
                                    #addcardMod .nice-select:active, #addcardMod .nice-select.open, #addcardMod .nice-select:focus { border-color: #4743c9 !important; }
                                    
                                    .section-divider-modal { height: 1px; background: #eef0f8; margin: 25px 0; }
                                    .btn-submit-premium-modal { display: block; width: 100%; padding: 15px; background: linear-gradient(135deg, #4743c9 0%, #0c266c 100%); color: #fff; font-size: 16px; font-weight: 700; border: none; border-radius: 20px; cursor: pointer; transition: transform 0.2s; }
                                    .btn-submit-premium-modal:hover { transform: translateY(-2px); color: #fff; }
                                </style>

                                <!-- Visual Card Preview -->
                                <div class="credit-card-visual-modal" id="modalCardVisual">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="marketing-chip-modal"></div>
                                        <div class="card-brand-logo-modal" id="modalCardLogo">
                                            <i class="fas fa-credit-card"></i>
                                        </div>
                                    </div>

                                    <div class="card-number-large-modal" id="modalCardNumberDisplay">
                                        •••• •••• •••• ••••
                                    </div>

                                    <div class="d-flex justify-content-between align-items-end mt-4">
                                        <div>
                                            <div class="card-meta-labels-modal">Card Holder</div>
                                            <div class="card-meta-values-modal" id="modalCardHolderDisplay">YOUR NAME</div>
                                        </div>
                                        <div class="text-end">
                                            <div class="card-meta-labels-modal">Expires</div>
                                            <div class="card-meta-values-modal" id="modalCardExpiryDisplay">MM/YY</div>
                                        </div>
                                    </div>
                                </div>

                                <form action="{% url 'core:add-card' %}" method="POST" id="modalAddCardForm" autocomplete="off">
                                    {% csrf_token %}
                                    
                                    <!-- Card Details Group -->
                                    <div class="row">
                                        <div class="col-lg-5">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">Card Brand</label>
                                                <select name="card_type" id="modalCardType" class="nice-select wide" required>
                                                    <option value="" disabled selected>Select Brand</option>
                                                    <option value="visa">Visa</option>
                                                    <option value="master">Mastercard</option>
                                                    <option value="amex">Amex</option>
                                                    <option value="discover">Discover</option>
                                                    <option value="verve">Verve</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-7">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">Card Number</label>
                                                <input type="text" name="card_number" id="modalCardNumber" class="custom-input-modal" 
                                                    placeholder="0000 0000 0000 0000" maxlength="19" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Name -->
                                    <div class="form-group-custom-modal">
                                        <label class="form-label-custom-modal">Cardholder Name</label>
                                        <input type="text" name="card_holder" id="modalCardHolder" class="custom-input-modal" 
                                            placeholder="Name on Card" required>
                                    </div>

                                    <!-- Expiry & CVV -->
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <label class="form-label-custom-modal">Expiry Date</label>
                                            <div class="row gx-2">
                                                <div class="col-6">
                                                    <div class="form-group-custom-modal">
                                                        <input type="text" name="expiry_month" id="modalExpiryMonth" class="custom-input-modal text-center" 
                                                            placeholder="MM" maxlength="2" required>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group-custom-modal">
                                                        <input type="text" name="expiry_year" id="modalExpiryYear" class="custom-input-modal text-center" 
                                                            placeholder="YY" maxlength="2" required>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">CVV / CVC</label>
                                                <input type="password" name="cvv" id="modalCvv" class="custom-input-modal text-center" 
                                                    placeholder="123" maxlength="4" required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="section-divider-modal"></div>
                                    <h6 class="mb-3" style="color: #0c266c;">Billing Address</h6>

                                    <div class="form-group-custom-modal">
                                        <label class="form-label-custom-modal">Address Line 1</label>
                                        <input type="text" name="address_line1" class="custom-input-modal" placeholder="Street Address" required>
                                    </div>

                                    <div class="form-group-custom-modal">
                                        <label class="form-label-custom-modal">Address Line 2 (Optional)</label>
                                        <input type="text" name="address_line2" class="custom-input-modal" placeholder="Apartment, Suite, Unit">
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">City</label>
                                                <input type="text" name="city" class="custom-input-modal" required>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">State / Province</label>
                                                <input type="text" name="state" class="custom-input-modal" required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">Zip / Postal Code</label>
                                                <input type="text" name="zip_code" class="custom-input-modal" required>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group-custom-modal">
                                                <label class="form-label-custom-modal">Country</label>
                                                <input type="text" name="country" class="custom-input-modal" required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-2">
                                        <button type="submit" class="btn-submit-premium-modal">Add Card</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Add Card Popup start -->

<!-- Scripts for Modal Interaction -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const brands = {
            visa: { icon: 'fa-brands fa-cc-visa', color: 'linear-gradient(135deg, #1A1F71 0%, #29318C 100%)', iconColor: '#005eff' },
            master: { icon: 'fa-brands fa-cc-mastercard', color: 'linear-gradient(135deg, #EB001B 0%, #F79E1B 100%)', iconColor: '#0a0a0a' },
            amex: { icon: 'fa-brands fa-cc-amex', color: 'linear-gradient(135deg, #006FCF 0%, #004687 100%)', iconColor: '#74C0FC' },
            discover: { icon: 'fa-brands fa-cc-discover', color: 'linear-gradient(135deg, #FF6000 0%, #FF9D00 100%)', iconColor: '#f7ab08' },
            verve: { icon: 'fa-solid fa-credit-card', color: 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)', iconColor: '#04307c' },
            default: { icon: 'fa-solid fa-credit-card', color: 'linear-gradient(135deg, #4743c9 0%, #0c266c 100%)', iconColor: '#04307c' }
        };

        const modalVisual = document.getElementById('modalCardVisual');
        const modalLogo = document.getElementById('modalCardLogo');
        const modalNumberDisplay = document.getElementById('modalCardNumberDisplay');
        const modalHolderDisplay = document.getElementById('modalCardHolderDisplay');
        const modalExpiryDisplay = document.getElementById('modalCardExpiryDisplay');
        
        function updateModalBrand(type) {
            const brand = brands[type] || brands.default;
            if(modalLogo) modalLogo.innerHTML = `<i class="${brand.icon}" style="color: ${brand.iconColor || '#fff'}"></i>`;
            if(modalVisual) modalVisual.style.background = brand.color;
        }

        const modalNumberInput = document.getElementById('modalCardNumber');
        if(modalNumberInput) {
            modalNumberInput.addEventListener('input', function(e) {
                let raw = e.target.value.replace(/\D/g, '');
                if(raw.length > 16) raw = raw.substring(0, 16);
                let fmt = raw.match(/.{1,4}/g)?.join(' ') || '';
                e.target.value = fmt;
                modalNumberDisplay.textContent = fmt || '•••• •••• •••• ••••';
                
                // Simple auto-detect (simplified for modal)
                if(/^4/.test(raw)) updateModalBrand('visa');
                else if(/^(5[1-5]|2[2-7])/.test(raw)) updateModalBrand('master');
                else if(/^3[47]/.test(raw)) updateModalBrand('amex');
                else if(/^(6011|65|64[4-9])/.test(raw)) updateModalBrand('discover');
            });
        }

        const modalHolderInput = document.getElementById('modalCardHolder');
        if(modalHolderInput) {
            modalHolderInput.addEventListener('input', (e) => {
                modalHolderDisplay.textContent = e.target.value.toUpperCase() || 'YOUR NAME';
            });
        }

        const mExpMonth = document.getElementById('modalExpiryMonth');
        const mExpYear = document.getElementById('modalExpiryYear');
        const modalSubmitBtn = document.querySelector('.btn-submit-premium-modal');
        
        function updateModalExpiry() {
            const m = mExpMonth.value;
            const y = mExpYear.value;
            modalExpiryDisplay.textContent = `${m || 'MM'}/${y || 'YY'}`;
            
            validateExpiry(m, y);
        }
        
        function validateExpiry(month, year) {
            // Remove previous error styles
            mExpMonth.style.borderColor = "#eef0f8";
            mExpYear.style.borderColor = "#eef0f8";
            modalSubmitBtn.disabled = false;
            modalSubmitBtn.style.opacity = "1";
            
            if (!month || !year) return;
            if (month.length < 2 || year.length < 2) return;
            
            const currentYear = new Date().getFullYear() % 100; // Get last 2 digits
            const currentMonth = new Date().getMonth() + 1;
            
            const expMonth = parseInt(month, 10);
            const expYear = parseInt(year, 10);
            
            let isValid = true;
            
            // Basic validation
            if (expMonth < 1 || expMonth > 12) {
                mExpMonth.style.borderColor = "red";
                isValid = false;
            } else {
                 mExpMonth.style.borderColor = "#eef0f8";
            }
            
            // Expiry check
            if (isValid) {
                if (expYear < currentYear) {
                    mExpYear.style.borderColor = "red";
                    isValid = false;
                } else if (expYear === currentYear && expMonth < currentMonth) {
                    mExpMonth.style.borderColor = "red";
                    isValid = false;
                }
            }
            
            if (!isValid) {
                modalSubmitBtn.disabled = true;
                modalSubmitBtn.style.opacity = "0.5";
            } else {
                modalSubmitBtn.disabled = false;
                modalSubmitBtn.style.opacity = "1";
            }
        }

        if(mExpMonth) mExpMonth.addEventListener('input', updateModalExpiry);
        if(mExpYear) mExpYear.addEventListener('input', updateModalExpiry);

        // jQuery for Nice Select change in Modal
        if (window.jQuery) {
            $('#modalCardType').on('change', function() {
                updateModalBrand(this.value);
            });
        }
    });
</script>

<!-- Transactions Popup start -->
<div class="transactions-popup">
    <div class="container-fruid">
        <div class="row">
            <div class="col-lg-6">
                <div class="modal fade" id="transactionsMod" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header justify-content-between">
                                <h5>Transaction Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i
                                        class="fa-solid fa-xmark"></i></button>
                            </div>
                            <div class="main-content">
                                <div class="row">
                                    <div class="col-sm-5 text-center">
                                        <div class="icon-area">
                                            <img src="assets/images/icon/transaction-details-icon.png" alt="icon">
                                        </div>
                                        <div class="text-area">
                                            <h6>Envato Pty Ltd</h6>
                                            <p>16 Jan 2022</p>
                                            <h3>717.14 USD</h3>
                                            <p class="com">Completed</p>
                                        </div>
                                    </div>
                                    <div class="col-sm-7">
                                        <div class="right-area">
                                            <h6>Transaction Details</h6>
                                            <ul class="payment-details">
                                                <li>
                                                    <span>Payment Amount</span>
                                                    <span>718.64 USD</span>
                                                </li>
                                                <li>
                                                    <span>Fee</span>
                                                    <span>1.50 USD</span>
                                                </li>
                                                <li>
                                                    <span>Total Amount</span>
                                                    <span>717.14 USD</span>
                                                </li>
                                            </ul>
                                            <ul class="payment-info">
                                                <li>
                                                    <p>Payment From</p>
                                                    <span class="mdr">Envato Pty Ltd</span>
                                                </li>
                                                <li>
                                                    <p>Payment Description</p>
                                                    <span class="mdr">Envato Feb 2022 Member Payment</span>
                                                </li>
                                                <li>
                                                    <p>Transaction ID:</p>
                                                    <span class="mdr">6559595979565959895559595</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Transactions Popup start -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var options = {
        series: [{{ total_sent|floatformat:2 }}, {{ total_received|floatformat:2 }}],
        chart: {
        width: 350,
        type: 'donut',
    },
        labels: ['Total Sent', 'Total Received'],
        colors: ['#FF4560', '#00E396'],
        dataLabels: {
        enabled: false
    },
        responsive: [{
            breakpoint: 1449,
            options: {
                chart: {
                    width: 300
                },
                legend: {
                    show: true
                }
            }
        },
        {
            breakpoint: 1200,
            options: {
                chart: {
                    width: 250
                },
                legend: {
                    show: true
                }
            }
        },
        {
            breakpoint: 992,
            options: {
                chart: {
                    width: 350
                },
                legend: {
                    show: true
                }
            }
        },
        {
            breakpoint: 577,
            options: {
                chart: {
                    width: 250
                },
                legend: {
                    show: true
                }
            }
        },
    ],
        legend: {
        position: 'right',
        offsetY: 0,
        height: 230,
    }
        };

    var chart = new ApexCharts(document.querySelector("#payment-chart"), options);
    chart.render();
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Simple balance display without currency features
    });
</script>
{% endblock content %}