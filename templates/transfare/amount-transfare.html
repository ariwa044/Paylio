{% extends 'partials/dashboard-base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<!-- Dashboard Section start -->
<section class="dashboard-section body-collapse pay step step-2">
    <div class="overlay pt-120">
        <div class="container-fruid">
            <div class="main-content">
                <div class="head-area d-flex align-items-center justify-content-between">
                    <h4>Make a Payment</h4>
                    <div class="icon-area">
                        <img src="{% static 'assets1/images/icon/support-icon.png' %}" alt="icon">
                    </div>
                </div>
                <div class="choose-recipient">
                    <div class="step-area">
                        <span class="mdr">Step 2 of 3</span>
                        <h5>Set Amount of transfer</h5>
                    </div>
                    <div class="user-select">
                        <div class="single-user">
                            <div class="left d-flex align-items-center">
                                <div class="img-area">
                                    {% if account and account.user.kyc.image %}
                                    <img style="width: 100px; height: 100px; border-radius: 50%"
                                        src="{{account.user.kyc.image.url}}" alt="image">
                                    {% else %}
                                    <img style="width: 100px; height: 100px; border-radius: 50%"
                                        src="{% static 'assets1/images/default.jpg' %}" alt="image">
                                    {% endif %}
                                </div>
                                <div class="text-area">
                                    {% if account %}
                                    <p>{{account.user.kyc.full_name|title}}</p>
                                    <p>{{account.account_number|title}}</p>
                                    <small>{{account.user.email}}</small>
                                    {% else %}
                                    <p>External Account</p>
                                    <p>{{new_account_number}}</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="right">

                                <a href="{% url 'core:search-account' %}">
                                    Edit
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <form action="{% url 'core:amount-transfare-Process' new_account_number %}" method="POST">
                    {% csrf_token %}
                    {% if not account %}
                    <div class="send-banance">
                        <span class="mdr">Receiver Name</span>
                        <div class="input-area">
                            <input class="xxlr" placeholder="Enter Receiver Name" name="name" type="text"
                                value="{{beneficiary_name|default:''}}" required>
                        </div>
                    </div>
                    <div class="send-banance">
                        <span class="mdr">Bank Name</span>
                        <div class="input-area">
                            <input class="xxlr" list="bank_list" placeholder="Search or Select Bank" name="bank_name"
                                value="{{beneficiary_bank|default:''}}" required>
                            <datalist id="bank_list">
                                <option value="Ally Bank">
                                <option value="American Express National Bank">
                                <option value="Bank of America">
                                <option value="Barclays Bank">
                                <option value="BMO Harris Bank">
                                <option value="Capital One">
                                <option value="Charles Schwab Bank">
                                <option value="Chase Bank">
                                <option value="Citibank">
                                <option value="Citizens Bank">
                                <option value="Discover Bank">
                                <option value="Fifth Third Bank">
                                <option value="Goldman Sachs Bank USA">
                                <option value="HSBC Bank USA">
                                <option value="Huntington National Bank">
                                <option value="KeyBank">
                                <option value="M&T Bank">
                                <option value="Navy Federal Credit Union">
                                <option value="PNC Bank">
                                <option value="Regions Bank">
                                <option value="Santander Bank">
                                <option value="SunTrust Bank">
                                <option value="Synchrony Bank">
                                <option value="TD Bank">
                                <option value="Truist Bank">
                                <option value="Union Bank">
                                <option value="USAA Federal Savings Bank">
                                <option value="U.S. Bank">
                                <option value="Wells Fargo">
                            </datalist>
                        </div>
                    </div>
                    {% endif %}

                    <div class="send-banance">
                        <span class="mdr">You Send</span>
                        <div class="input-area">
                            <input class="xxlr" onkeyup="CalculateBalance()"
                                placeholder="{{ request.user.account.account_balance|intcomma}}" name="amount-send"
                                type="number" id="amount-send" required>
                            <select>
                                <option value="1">USD</option>
                            </select>
                        </div>
                        <p>Available Balance<b>${{request.user.account.account_balance}}</b></p>
                        <p id="new_balance"></p>
                        <p class="text-danger" id="error-div"></p>
                    </div>
                    <div class="send-banance">
                        <span class="mdr">Payment Description</span>
                        <div class="input-area">
                            <input class="xxlr" placeholder="payment for fees" name="description" type="text">
                        </div>

                    </div>

                    <div class="send-banance mt-3">
                        {% if is_beneficiary %}
                        <p class="text-success" style="font-weight: 600;"><i class="fas fa-check-circle"></i> This
                            account is already in your beneficiaries list.</p>
                        {% else %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="save_beneficiary"
                                id="save_beneficiary", style="margin-right: 5px; padding: 2mm; margin-top: 6px;">
                            <label class="form-check-label" for="save_beneficiary" style="color: #555;">
                                Add to beneficiaries for future transfers
                            </label>
                        </div>
                        {% endif %}
                    </div>

                    <script>
                        function CalculateBalance() {
                            let available_balance = "{{ request.user.account.account_balance }}"
                            let new_balance = document.getElementById("new_balance")
                            let sendAmount_input = document.getElementById("amount-send")
                            let sendAmount = sendAmount_input.value
                            let errorDiv = document.getElementById("error-div")
                            let total_to_pay = document.getElementById('total-to-pay')

                            let errors = []
                            new_bal = available_balance - sendAmount
                            new_balance.innerHTML = `New Balance <b> $${new_bal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} </b>`;
                            total_to_pay.innerHTML = `USD <b> $${sendAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} </b>`;

                            if (new_bal < 0) {
                                new_balance.style.color = "red"
                                alert('You can only send $' + available_balance.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","))

                            } else {
                                new_balance.style.color = 'black'
                            }

                        }
                    </script>
                    <ul class="total-fees">
                        <li>Total Fees</li>
                        <li>Free</li>
                    </ul>
                    <ul class="total-fees pay">
                        <li>
                            <h5>Total To Pay</h5>
                        </li>
                        <li>
                            <h5 id="total-to-pay">USD 0.00</h5>
                        </li>
                    </ul>
                    <div class="footer-area mt-40">
                        <a href="{% url 'core:search-account' %}" style="line-height: normal;">Previous Step</a>
                        <button type="submit"
                            style="padding: 10px; border-radius: 20px; background: rgb(98, 0, 255); color: #fff;"
                            class="active">Next</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
<!-- Dashboard Section end -->

{% endblock content %}